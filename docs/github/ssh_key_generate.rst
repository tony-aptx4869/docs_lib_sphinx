SSH 密钥创建大法
================

无论是实现 SSH 免密登录，还是想要 SCP 免密发送文件，还是 Git 免密提交代码，都需要用到 SSH 密钥。
本文简单介绍 SSH 密钥的生成方法。

科普几个基本概念
----------------

密钥
   在密码学中，密钥（key，又常称：金钥）是指某个用来完成加密、解密、完整性验证等密码学应用的秘密信息。
   在对称密码学（或称：密钥密码学）中，加密和解密用的是同一个钥匙，因此钥匙需要保密。
   而在非对称密码学（或称：公钥密码学）中，加密和解密用的钥匙不同：通常一个是公开的，称为公钥；另一个保密，称为私钥。
   其书面语读音为 mìyuè，口语读音为 mìyào [1]_ 。


.. [1]
   「密钥」中的「钥」为多音字。其在文言文中有文白异读的现象。1985年12月，中华人民共和国国家语委、国家教委和广播电视部联合发布的《普通话异读词审音表》将其标注为 yào（语）和 yuè（文）两种读音。《现代汉语词典（第7版）》中将其注明为「【密钥】mìyuè（口语中多读 mìyào）」。

.. index::
   single: 密钥, 对称密码学, 非对称密码学, 公钥, 私钥


简单科普 SSH 密钥对
-------------------

简单地科普一下 SSH 公钥和私钥。

SSH 公钥和私钥是一种认证机制，服务器用它来确认「你是你」。
通过加密算法生成的一对公钥和私钥是相互对应的，一对一的关系，就是过去「一个锁头配一把钥匙」的关系。
服务器方拿着公钥，这好比是「锁头」啊，用户方或者客户端方拿着密钥，好比是「钥匙」。
「钥匙」能打开「锁头」，服务器就确认「你是你」，让你通过。
而这把「钥匙」带给人最直观的感受就是，使用起来不再输入账户密码了。

.. warning::
   同学们一定要保护好自己的密钥文件，尤其是私钥文件，不要轻易分享给他人！

ssh-keygen 简介
---------------

``ssh-keygen`` 命令用于为 SSH 生成、管理和转换认证密钥，它支持 ``RSA`` 和 ``DSA`` 两种认证密钥。

语法格式
^^^^^^^^

.. prompt:: bash $

   ssh-keygen [参数]

常用参数
^^^^^^^^

======     ==========================================
参数        含义
======     ==========================================
-b         指定密钥长度
-e         读取openssh的私钥或者公钥文件
-f         指定用来保存密钥的文件名
-t         指定要创建的密钥类型
-C         添加注释
======     ==========================================

生成 SSH 公钥和私钥
-------------------

打开终端 ``Terminal`` ，首先确认当前用户的 ``home`` 目录下有没有一个叫 ``.ssh`` 的目录，
不存在的话请先创建，并赋予 ``700`` 的权限。

.. prompt:: bash $

   cd ~
   mkdir -p ~/.ssh
   chmod 700 ~/.ssh


直接使用 ``ssh-keygen`` 命令，不带任何参数，生成一对默认的公钥和私钥。

.. prompt:: bash $

   ssh-keygen


由于我们没有使用 ``-f`` 参数指定路径和文件名，程序会有如下提示。

 | Generating public/private rsa key pair.
 | Enter file in which to save the key (/Users/tony/.ssh/id_rsa):

直接敲回车，使用默认路径和文件名。
程序又会有如下提示，询问是否为密钥文件设置密码。

 | Enter passphrase (empty for no passphrase):
 | Enter same passphrase again:

我们为了免密使用密钥，对于这两条提示都直接敲空格。如果有特殊的用途需要设置密码，那么请一定要将密码妥善保管。

.. warning::

   若没有为密钥设置密码（密码为空，直接两次敲了空格），请一定要保护好自己的私钥文件，不要轻易分享给他人！

.. tip::

   若要为密钥设置密码，强烈建议使用密码生成器自动生成强密码，并使用密码管理工具，例如 Apple 平台的「钥匙串」。

设置密码后，程序会提示如下，表明公钥和私钥文件已经创建完成。

 | Your identification has been saved in /Users/tony/.ssh/id_rsa.
 | Your public key has been saved in /Users/tony/.ssh/id_rsa.pub.
 | The key fingerprint is:
 | ...(此处省略内容视实际情况)

``id_rsa`` 文件即是密钥文件， ``id_rsa.pub`` 即是公钥文件。

从这个示例来看，不带任何参数的情况下， ``ssh-keygen`` 会默认生成一对 ``RSA`` 类型的公钥和私钥。

当然，你还可以使用 ``-t`` 参数手动指定生成 RSA 类型的公钥和私钥。

.. prompt:: bash $

   ssh-keygen -t rsa

其他示例
--------

使用 ``-t`` 参数手动指定生成 ``RSA`` 类型的公钥和私钥，并使用 ``-C`` 参数添加注释，例如邮箱地址：

.. prompt:: bash $
   
   ssh-keygen -t rsa -C "your_email_address@example.com"

使用 ``-e`` 参数读取 ``openssh`` 的私钥或者公钥文件：

.. prompt:: bash $

   ssh-keygen -e

